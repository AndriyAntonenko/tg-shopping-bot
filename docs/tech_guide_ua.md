# Технічний посібник

Цей документ містить технічні деталі про TG Shopping Bot, його архітектуру та інструкції з розгортання.

## Архітектура

Бот створений з використанням Python та бібліотеки `pyTelegramBotAPI` (Telebot). Він використовує механізм опитування (polling) для отримання оновлень від Telegram.

### Основні компоненти:
- **Мова**: Python 3.12+
- **Фреймворк**: `pyTelegramBotAPI` (Telebot)
- **База даних**: SQLite (для зберігання замовлень, товарів, відгуків)
- **Сховище**: Digital Ocean Spaces (S3-сумісне) для зберігання зображень товарів.
- **Контейнеризація**: Docker та Docker Compose

## Передумови

Для запуску бота вам знадобляться:
- Docker та Docker Compose, встановлені на хост-машині.
- Токен Telegram-бота (від @BotFather).
- API-ключ Stripe (для платежів).
- Облікові дані Digital Ocean Spaces (для зберігання зображень).

## Налаштування

Бот налаштовується через змінні середовища. Створіть файл `.env` у кореневому каталозі з наступними змінними:

```env
TG_BOT_KEY=ваш_токен_бота
TG_BOT_NAME=ім'я_вашого_бота
STRIPE_API_KEY=ваш_ключ_stripe
DATABASE_PATH=./data/shop.db

# Digital Ocean Spaces
DO_SPACES_REGION=ваш_регіон
DO_SPACES_ENDPOINT=ваш_endpoint
DO_SPACES_KEY=ваш_ключ_доступу
DO_SPACES_SECRET=ваш_секретний_ключ
DO_SPACES_BUCKET=назва_вашого_бакету
```

## Розгортання на Digital Ocean Droplet

Виконайте наступні кроки, щоб розгорнути бота на Digital Ocean Droplet (або будь-якому Linux-сервері з Docker).

### 1. Підключення до Droplet через SSH

Відкрийте термінал і підключіться до вашого сервера:

```bash
ssh root@your_droplet_ip
```

### 2. Клонування репозиторію

Клонуйте репозиторій проекту на сервер:

```bash
git clone <repository_url>
cd <project_directory>
```

### 3. Налаштування змінних середовища

Створіть файл `.env` і заповніть його вашими обліковими даними:

```bash
cp .env.example .env
nano .env
```
(Зберегти та вийти: `Ctrl+O`, `Enter`, `Ctrl+X`)

### 4. Збірка та запуск за допомогою Docker Compose

Зберіть Docker-образ і запустіть контейнер у фоновому режимі:

```bash
docker-compose up -d --build
```

### 5. Перевірка розгортання

Перевірте, чи запущено контейнер:

```bash
docker-compose ps
```

Перегляньте логи, щоб переконатися, що бот успішно запустився:

```bash
docker-compose logs -f
```

## Міграції бази даних

Бот автоматично застосовує міграції бази даних при запуску, використовуючи внутрішню систему міграцій (`src/db/migrations.py`). Файл бази даних зберігається в каталозі `./data`, який підмонтований як том у `docker-compose.yml` для збереження даних.
